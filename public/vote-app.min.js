"use strict";angular.module("authentication",[]),angular.module("cookiesWarning",["ngCookies"]),angular.module("messages",[]),angular.module("navigation",["authentication"]),angular.module("vote-app",["chart.js","navigation","authentication","ngRoute","messages","cookiesWarning","btford.socket-io"]),angular.module("authentication").controller("AuthenticationController",["$scope","user",function(t,e){t.auth={},e.loadUser(t.auth),t.logOut=function(){e.logOut.bind(null,t.auth)(),console.log(t.auth)}}]),angular.module("authentication").factory("user",["$http","$rootScope",function(t,e){function o(){return!angular.equals({},n)}var n={};return{loadUser:function(l){o()?l.user=n:t.get("/auth/user").then(function(t){n=t.data,o()&&(n.isAuthenticated=!0),e.$broadcast("user",n),l.user=n}).catch(function(t){throw n={isAuthenticated:!1},t})},getUser:function(){return n},logOut:function(o){t.get("/auth/logout").then(function(){n={isAuthenticated:!1},o.user=n,e.$broadcast("user",n)}).catch(function(t){throw n={isAuthenticated:!1},o.user=n,t})}}}]),angular.module("cookiesWarning").factory("cookie",["$rootScope","$cookies",function(t,e){return{isAccepted:function(){return!!e.get("cookiesPolicyAccepted")},accept:function(){e.put("cookiesPolicyAccepted",!0),t.$broadcast("cookiesPolicyAccepted")}}}]),angular.module("cookiesWarning").directive("cookiesWarning",function(){return{restrict:"E",transclude:!0,controller:"CookiesWarningController",templateUrl:"views/cookies-policy.client.view.html"}}),angular.module("cookiesWarning").controller("CookiesWarningController",["$scope","cookie",function(t,e){t.isAccepted=e.isAccepted(),t.accept=e.accept,t.$on("cookiesPolicyAccepted",function(){t.isAccepted=!0})}]),angular.module("messages").controller("MessagesController",["$scope",function(t){t.message=[],t.$on("messages",function(e,o){return t.messages=o}),t.$on("$routeChangeStart",function(){return t.messages=[]})}]),angular.module("messages").directive("messages",function(){return{templateUrl:"views/messages.client.view.html",restrict:"E"}}),angular.module("messages").factory("messages",["$rootScope",function(t){return{handleErrors:function(e){var o=e.data.map(function(t){return{content:t.content,class:"alert alert-"+t.type}});t.$broadcast("messages",o)}}}]),angular.module("navigation").controller("NavigationController",["$scope","$window",function(t,e){t.twitterAuth=function(){return e.location.assign("/auth/twitter")}}]),angular.module("navigation").directive("navigation",function(){return{templateUrl:"views/header.client.view.html",restrict:"E"}}),angular.module("vote-app").controller("AllPollsController",["$scope","poll","$attrs","user",function(t,e,o,n){var l=n.getUser();t.queryParam={},o.hasOwnProperty("ownerOnly")&&(t.queryParam._creator=l._id),e.getPolls(t,{limit:10,offset:0}),t.getPolls=e.getPolls.bind(null,t)}]),angular.module("vote-app").directive("allPolls",function(){return{controller:"AllPollsController",templateUrl:"views/all-polls.client.view.html"}}),angular.module("vote-app").controller("ChartController",["$scope","poll","user","socketFactory","$routeParams",function(t,e,o,n,l){t.user=o.getUser(),t.vote="",e.getPoll().then(function(o){t.poll=e.transform(o.data);var r=io.connect("/"+l.id),a=n({ioSocket:r});a.on("chartUpdate",function(o){t.poll=e.transform(o)})}),t.votePoll=e.votePoll.bind(null,t),t.deletePoll=e.deletePoll,t.$on("user",function(e,o){t.user=o})}]),angular.module("vote-app").controller("PollController",["poll","$scope",function(t,e){e.poll={title:"",options:""},e.createPoll=t.createPoll}]),angular.module("vote-app").factory("poll",["$http","$location","$routeParams","messages",function(t,e,o,n){var l={transform:function(t){var e=t.options.map(function(t){return{label:t,value:t}});return e.push({label:"I'd like custom option",value:null}),{title:t.title,labels:t.options,selectBoxOptions:e,options:{legend:{display:!0,position:"bottom"}},data:t.votes,owner:t.owner}},getPolls:function(e,o){var n="api/polls/?limit="+o.limit+"&offset="+o.offset+"&time="+Date.now();e.queryParam._creator&&(n+="&user="+e.queryParam._creator),t.get(n).then(function(t){if(e.polls&&e.query&&e.query.time-t.data.time>0)return void console.log("Ignoring old request");e.polls=t.data.polls,e.query=t.data.query,e.range=[];for(var o=0;o<t.data.query.count;o+=10)e.range.push({query:{limit:10,offset:o}})}).catch(function(t){throw t})},createPoll:function(o){t.post("api/poll",{title:o.title,options:o.options.split("\n")}).then(function(t){e.path("/poll/"+t.data._id)}).catch(function(t){throw t})},getPoll:function(){return t.get("/api/poll/"+o.id).catch(function(t){throw t})},deletePoll:function(n){t.delete("/api/poll/"+o.id).then(function(t){e.path("/my-polls")}).catch(function(t){throw t})},votePoll:function(e){var r="";r=null===e.vote?e.customOption||"":e.vote,t.put("/api/poll/"+o.id,{vote:r}).then(function(t){e.poll=l.transform(t.data)}).catch(n.handleErrors)}};return l}]),angular.module("vote-app").config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"views/polls.client.view.html"}).when("/new-poll",{templateUrl:"views/new-poll.client.view.html"}).when("/my-polls",{templateUrl:"views/my-polls.client.view.html"}).when("/poll/:id",{templateUrl:"views/poll.client.view.html"}).otherwise("/",{redirect:"/"}),e.html5Mode(!0)}]);